<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVGIS Data Visualization Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 15px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: #3498db;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn.active {
            background: #e74c3c;
        }

        .system-specs {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .system-specs h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .spec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #bdc3c7;
        }

        .spec-label {
            font-weight: 500;
            color: #34495e;
        }

        .spec-value {
            color: #2c3e50;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .optimization-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider {
            width: 200px;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: none;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåû PVGIS Data Visualization Dashboard</h1>
            <p>Real-time PV Performance Analysis for Turin, Italy</p>
            <div id="pvgis-status" class="loading">Checking PVGIS connection...</div>
        </div>

        <div class="dashboard-grid">
            <!-- PVGIS Status -->
            <div class="card full-width">
                <h2>üîó PVGIS Connection Status</h2>
                <div id="pvgis-connection-status" class="loading">Loading PVGIS status...</div>
                <div class="controls">
                    <button class="btn" onclick="fetchRealTimeData()">üîÑ Fetch Real-Time PVGIS Data</button>
                    <button class="btn" onclick="checkPVGISStatus()">üì° Check Connection</button>
                </div>
            </div>

            <!-- PV Performance Summary -->
            <div class="card full-width">
                <h2>üìä PV Performance Summary</h2>
                <div id="performance-summary" class="loading">Loading performance data...</div>
            </div>

            <!-- Hourly PV Generation -->
            <div class="card">
                <h2>‚ö° Hourly PV Generation</h2>
                <div class="controls">
                    <button class="btn active" onclick="loadHourlyChart('24h')">24 Hours</button>
                    <button class="btn" onclick="loadHourlyChart('8760h')">Full Year</button>
                </div>
                <div class="chart-container">
                    <canvas id="hourlyChart"></canvas>
                </div>
            </div>

            <!-- Monthly PV Generation -->
            <div class="card">
                <h2>üìÖ Monthly PV Generation</h2>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <!-- Daily Profiles by Season -->
            <div class="card">
                <h2>üåç Daily Profiles by Season</h2>
                <div class="controls">
                    <button class="btn active" onclick="loadDailyProfile('summer')">Summer</button>
                    <button class="btn" onclick="loadDailyProfile('winter')">Winter</button>
                    <button class="btn" onclick="loadDailyProfile('spring')">Spring</button>
                    <button class="btn" onclick="loadDailyProfile('autumn')">Autumn</button>
                </div>
                <div class="chart-container">
                    <canvas id="dailyProfileChart"></canvas>
                </div>
            </div>

            <!-- Energy Balance Analysis -->
            <div class="card">
                <h2>‚öñÔ∏è Energy Balance Analysis</h2>
                <div id="energy-balance" class="loading">Loading energy balance...</div>
            </div>

            <!-- Energy Optimization -->
            <div class="card full-width">
                <h2>üîã Energy Optimization Scenario</h2>
                <div class="optimization-controls">
                    <div class="slider-container">
                        <label for="batterySOC">Battery SOC:</label>
                        <input type="range" id="batterySOC" class="slider" min="0" max="1" step="0.1" value="0.5">
                        <span id="socValue">50%</span>
                    </div>
                    <button class="btn" onclick="updateOptimization()">Update Optimization</button>
                </div>
                <div class="chart-container">
                    <canvas id="optimizationChart"></canvas>
                </div>
            </div>

            <!-- System Specifications -->
            <div class="card">
                <h2>‚öôÔ∏è System Specifications</h2>
                <div id="system-specs" class="loading">Loading system specifications...</div>
            </div>
        </div>
    </div>

    <script>
        // Chart instances
        const charts = {};

        // Check PVGIS connection status
        async function checkPVGISStatus() {
            try {
                const response = await fetch('/api/pvgis/status');
                const status = await response.json();
                
                if (status.error) {
                    document.getElementById('pvgis-connection-status').innerHTML = 
                        `<div class="error">Error: ${status.error}</div>`;
                    return;
                }

                const statusHTML = `
                    <div class="metrics-grid">
                        <div class="metric">
                            <div class="metric-value">${status.pvgis_connected ? '‚úÖ' : '‚ùå'}</div>
                            <div class="metric-label">PVGIS Connected</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${status.data_source}</div>
                            <div class="metric-label">Data Source</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${status.location}</div>
                            <div class="metric-label">Location</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${status.coordinates}</div>
                            <div class="metric-label">Coordinates</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${status.years_available}</div>
                            <div class="metric-label">Years Available</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${status.database}</div>
                            <div class="metric-label">Database</div>
                        </div>
                    </div>
                    ${status.data_loaded ? `
                        <div class="success">
                            ‚úÖ Data loaded successfully: ${status.total_records} records, 
                            Daily generation: ${status.daily_generation_kwh.toFixed(2)} kWh
                        </div>
                    ` : `
                        <div class="error">
                            ‚ùå No data loaded. Click "Fetch Real-Time PVGIS Data" to load data.
                        </div>
                    `}
                `;
                
                document.getElementById('pvgis-connection-status').innerHTML = statusHTML;
                
            } catch (error) {
                console.error('Error checking PVGIS status:', error);
                document.getElementById('pvgis-connection-status').innerHTML = 
                    '<div class="error">Error checking PVGIS connection</div>';
            }
        }

        // Fetch real-time PVGIS data
        async function fetchRealTimeData() {
            try {
                document.getElementById('pvgis-connection-status').innerHTML = 
                    '<div class="loading">üîÑ Fetching real-time PVGIS data...</div>';
                
                const response = await fetch('/api/pvgis/fetch-real-data');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    
                    const successHTML = `
                        <div class="success">
                            ‚úÖ Real-time PVGIS data fetched successfully!
                        </div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-value">${data.total_daily_generation_kwh.toFixed(2)}</div>
                                <div class="metric-label">Daily Generation (kWh)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${data.peak_generation.pv_kw.toFixed(2)}</div>
                                <div class="metric-label">Peak Generation (kW)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${data.peak_generation.timestamp}</div>
                                <div class="metric-label">Peak Time</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${data.data_source}</div>
                                <div class="metric-label">Data Source</div>
                            </div>
                        </div>
                        <div class="system-specs">
                            <h3>Data Details</h3>
                            <div class="spec-grid">
                                <div class="spec-item">
                                    <span class="spec-label">Location:</span>
                                    <span class="spec-value">${data.location}</span>
                                </div>
                                <div class="spec-item">
                                    <span class="spec-label">Coordinates:</span>
                                    <span class="spec-value">${data.coordinates}</span>
                                </div>
                                <div class="spec-item">
                                    <span class="spec-label">Years:</span>
                                    <span class="spec-value">${data.years}</span>
                                </div>
                                <div class="spec-item">
                                    <span class="spec-label">Records:</span>
                                    <span class="spec-value">${data.daily_profile.length} hours</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('pvgis-connection-status').innerHTML = successHTML;
                    
                    // Refresh all charts with new data
                    setTimeout(() => {
                        loadPerformanceSummary();
                        loadHourlyChart('24h');
                        loadMonthlyChart();
                        loadDailyProfile('summer');
                        loadEnergyBalance();
                    }, 1000);
                    
                } else {
                    document.getElementById('pvgis-connection-status').innerHTML = 
                        `<div class="error">‚ùå Failed to fetch PVGIS data: ${result.error}</div>`;
                }
                
            } catch (error) {
                console.error('Error fetching real-time data:', error);
                document.getElementById('pvgis-connection-status').innerHTML = 
                    '<div class="error">‚ùå Error fetching real-time PVGIS data</div>';
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            checkPVGISStatus();
            loadPerformanceSummary();
            loadHourlyChart('24h');
            loadMonthlyChart();
            loadDailyProfile('summer');
            loadEnergyBalance();
            loadSystemSpecs();
            updateOptimization();

            // Battery SOC slider
            document.getElementById('batterySOC').addEventListener('input', function() {
                document.getElementById('socValue').textContent = Math.round(this.value * 100) + '%';
            });
        });

        // Load PV performance summary
        async function loadPerformanceSummary() {
            try {
                const response = await fetch('/api/pvgis/summary');
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('performance-summary').innerHTML = 
                        `<div class="error">Error: ${data.error}</div>`;
                    return;
                }

                const summaryHTML = `
                    <div class="metrics-grid">
                        <div class="metric">
                            <div class="metric-value">${Math.round(data.yearly_energy_production_kwh).toLocaleString()}</div>
                            <div class="metric-label">Annual Production (kWh)</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.daily_average_kwh.toFixed(1)}</div>
                            <div class="metric-label">Daily Average (kWh)</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.peak_generation_kw.toFixed(1)}</div>
                            <div class="metric-label">Peak Generation (kW)</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.capacity_factor_percent.toFixed(1)}%</div>
                            <div class="metric-label">Capacity Factor</div>
                        </div>
                    </div>
                    <div class="system-specs">
                        <h3>System Configuration</h3>
                        <div class="spec-grid">
                            <div class="spec-item">
                                <span class="spec-label">Location:</span>
                                <span class="spec-value">${data.system_specs.location}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Coordinates:</span>
                                <span class="spec-value">${data.system_specs.coordinates}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Installed Power:</span>
                                <span class="spec-value">${data.system_specs.installed_power_kwp} kWp</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Tilt Angle:</span>
                                <span class="spec-value">${data.system_specs.tilt_angle_deg}¬∞</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Azimuth:</span>
                                <span class="spec-value">${data.system_specs.azimuth_angle_deg}¬∞</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">System Loss:</span>
                                <span class="spec-value">${data.system_specs.system_loss_percent}%</span>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('performance-summary').innerHTML = summaryHTML;
                
            } catch (error) {
                console.error('Error loading performance summary:', error);
                document.getElementById('performance-summary').innerHTML = 
                    '<div class="error">Error loading performance summary</div>';
            }
        }

        // Load hourly PV chart
        async function loadHourlyChart(period) {
            try {
                const response = await fetch(`/api/pvgis/hourly?period=${period}`);
                const data = await response.json();
                
                if (data.error) {
                    console.error('Error loading hourly data:', data.error);
                    return;
                }

                createHourlyChart(data, period);
                
                // Update button states
                document.querySelectorAll('.controls button').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
            } catch (error) {
                console.error('Error loading hourly chart:', error);
            }
        }

        // Create hourly chart
        function createHourlyChart(data, period) {
            const ctx = document.getElementById('hourlyChart').getContext('2d');
            
            // Destroy existing chart
            if (charts.hourly) {
                charts.hourly.destroy();
            }
            
            charts.hourly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.hours,
                    datasets: [{
                        label: data.label,
                        data: data.values,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Power (kW)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: period === '24h' ? 'Hour of Day' : 'Hour of Year'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Load monthly chart
        async function loadMonthlyChart() {
            try {
                const response = await fetch('/api/pvgis/monthly');
                const data = await response.json();
                
                if (data.error) {
                    console.error('Error loading monthly data:', data.error);
                    return;
                }

                createMonthlyChart(data);
                
            } catch (error) {
                console.error('Error loading monthly chart:', error);
            }
        }

        // Create monthly chart
        function createMonthlyChart(data) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [{
                        label: 'Monthly Generation (kWh)',
                        data: data.map(d => d.generation_kwh),
                        backgroundColor: 'rgba(46, 204, 113, 0.8)',
                        borderColor: '#27ae60',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Generation (kWh)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Load daily profile
        async function loadDailyProfile(season) {
            try {
                const response = await fetch(`/api/pvgis/daily?type=${season}`);
                const data = await response.json();
                
                if (data.error) {
                    console.error('Error loading daily profile:', data.error);
                    return;
                }

                createDailyProfileChart(data, season);
                
                // Update button states
                document.querySelectorAll('.controls button').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
            } catch (error) {
                console.error('Error loading daily profile:', error);
            }
        }

        // Create daily profile chart
        function createDailyProfileChart(data, season) {
            const ctx = document.getElementById('dailyProfileChart').getContext('2d');
            
            if (charts.daily) {
                charts.daily.destroy();
            }
            
            charts.daily = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.hours,
                    datasets: [{
                        label: data.label,
                        data: data.values,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Power (kW)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hour of Day'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Load energy balance
        async function loadEnergyBalance() {
            try {
                const response = await fetch('/api/pvgis/energy-balance');
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('energy-balance').innerHTML = 
                        `<div class="error">Error: ${data.error}</div>`;
                    return;
                }

                const balanceHTML = `
                    <div class="metrics-grid">
                        <div class="metric">
                            <div class="metric-value">${data.pv_generation_kwh.toFixed(1)}</div>
                            <div class="metric-label">PV Generation (kWh)</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.load_consumption_kwh.toFixed(1)}</div>
                            <div class="metric-label">Load Consumption (kWh)</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.energy_balance_kwh.toFixed(1)}</div>
                            <div class="metric-label">Energy Balance (kWh)</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${data.self_sufficiency_percent.toFixed(1)}%</div>
                            <div class="metric-label">Self-Sufficiency</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('energy-balance').innerHTML = balanceHTML;
                
            } catch (error) {
                console.error('Error loading energy balance:', error);
                document.getElementById('energy-balance').innerHTML = 
                    '<div class="error">Error loading energy balance</div>';
            }
        }

        // Update optimization
        async function updateOptimization() {
            try {
                const soc = document.getElementById('batterySOC').value;
                const response = await fetch(`/api/pvgis/optimization?soc=${soc}`);
                const data = await response.json();
                
                if (data.error) {
                    console.error('Error loading optimization:', data.error);
                    return;
                }

                createOptimizationChart(data);
                
            } catch (error) {
                console.error('Error loading optimization:', error);
            }
        }

        // Create optimization chart
        function createOptimizationChart(data) {
            const ctx = document.getElementById('optimizationChart').getContext('2d');
            
            if (charts.optimization) {
                charts.optimization.destroy();
            }
            
            charts.optimization = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.hours,
                    datasets: [
                        {
                            label: 'Net Load',
                            data: data.net_load,
                            borderColor: '#95a5a6',
                            backgroundColor: 'rgba(149, 165, 166, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'Battery Charge',
                            data: data.battery_charge,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'Battery Discharge',
                            data: data.battery_discharge,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'Grid Import',
                            data: data.grid_import,
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'Grid Export',
                            data: data.grid_export,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            borderWidth: 2,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Power (kW)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hour of Day'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Load system specifications
        async function loadSystemSpecs() {
            try {
                const response = await fetch('/api/pvgis/system-specs');
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('system-specs').innerHTML = 
                        `<div class="error">Error: ${data.error}</div>`;
                    return;
                }

                const specsHTML = `
                    <div class="spec-grid">
                        <div class="spec-item">
                            <span class="spec-label">Capacity:</span>
                            <span class="spec-value">${data.Ebat_kWh} kWh</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Max Charge:</span>
                            <span class="spec-value">${data.Pch_max_kW} kW</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Max Discharge:</span>
                            <span class="spec-value">${data.Pdis_max_kW} kW</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">SOC Range:</span>
                            <span class="spec-value">${Math.round(data.SOCmin * 100)}% - ${Math.round(data.SOCmax * 100)}%</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Efficiency:</span>
                            <span class="spec-value">${Math.round(data.eta_dis * 100)}%</span>
                        </div>
                        <div class="spec-item">
                            <span class="spec-label">Cycle Life:</span>
                            <span class="spec-value">${data.life_cycle.toLocaleString()}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('system-specs').innerHTML = specsHTML;
                
            } catch (error) {
                console.error('Error loading system specs:', error);
                document.getElementById('system-specs').innerHTML = 
                    '<div class="error">Error loading system specifications</div>';
            }
        }
    </script>
</body>
</html>
