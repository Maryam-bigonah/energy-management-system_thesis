<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Figures Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 30px;
    }
    h1 { text-align: center; color: #333; margin-bottom: 10px; font-size: 2.3em; }
    .subtitle { text-align: center; color: #666; margin-bottom: 20px; font-size: 1.05em; }
    .section-title {
      margin-top: 26px;
      margin-bottom: 10px;
      font-size: 1.4em;
      color: #2c3e50;
      border-left: 6px solid #667eea;
      padding-left: 10px;
    }
    .figures-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(520px, 1fr));
      gap: 22px;
      margin-top: 12px;
    }
    .figure-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .figure-card:hover { transform: translateY(-3px); box-shadow: 0 8px 12px rgba(0,0,0,0.15); }
    .figure-title { font-size: 1.1em; font-weight: 700; color: #2c3e50; margin-bottom: 12px; text-align: center; }
    .figure-image { width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; }
    .loading { text-align: center; padding: 28px; color: #666; font-size: 1.1em; }
    .error { background: #fee; color: #c33; padding: 15px; border-radius: 5px; margin: 20px 0; text-align: center; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); cursor: pointer; }
    .modal-content { margin: auto; display: block; width: 92%; max-width: 1400px; margin-top: 40px; }
    .modal-close { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; }
    @media (max-width: 768px) {
      .figures-grid { grid-template-columns: 1fr; }
      h1 { font-size: 1.9em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>All Figures Dashboard</h1>
    <p class="subtitle">Thesis + Optimization + Forecasting figures (generated from your real data)</p>

    <div id="loading" class="loading">Loading figures…</div>
    <div id="error" class="error" style="display:none;"></div>

    <div id="sections"></div>
  </div>

  <div id="modal" class="modal">
    <span class="modal-close">&times;</span>
    <img class="modal-content" id="modal-image" />
  </div>

  <script>
    const API_BASE = 'http://localhost:5001/api/figures';

    const CATEGORY_LABELS = {
      thesis: 'Thesis Figures (Load/PV modeling)',
      optimization: 'Optimization Figures (O1–O5)',
      forecasting: 'Forecasting Figures (Summary)',
      forecasting_results: 'Forecasting Figures (Per-target weeks)'
    };

    async function loadFigures() {
      try {
        const response = await fetch(API_BASE);
        const data = await response.json();
        if (!data.available) {
          showError(data.error || 'Figures not available');
          return;
        }

        document.getElementById('loading').style.display = 'none';
        const sections = document.getElementById('sections');

        const grouped = {};
        for (const fig of data.figures) {
          if (!grouped[fig.category]) grouped[fig.category] = [];
          grouped[fig.category].push(fig);
        }

        for (const category of Object.keys(CATEGORY_LABELS)) {
          if (!grouped[category] || grouped[category].length === 0) continue;

          const title = document.createElement('div');
          title.className = 'section-title';
          title.textContent = CATEGORY_LABELS[category];
          sections.appendChild(title);

          const grid = document.createElement('div');
          grid.className = 'figures-grid';

          for (const figure of grouped[category]) {
            grid.appendChild(createFigureCard(figure));
          }
          sections.appendChild(grid);
        }
      } catch (err) {
        showError(`Error loading figures: ${err.message}`);
      }
    }

    function createFigureCard(figure) {
      const card = document.createElement('div');
      card.className = 'figure-card';

      const title = document.createElement('div');
      title.className = 'figure-title';
      title.textContent = figure.title;

      const img = document.createElement('img');
      img.className = 'figure-image';
      img.alt = figure.title;
      img.loading = 'lazy';

      fetch(`http://localhost:5001${figure.url}`)
        .then(res => res.json())
        .then(data => { img.src = `data:image/png;base64,${data.image}`; })
        .catch(() => { img.alt = 'Error loading image'; });

      img.addEventListener('click', () => openModal(img.src));

      card.appendChild(title);
      card.appendChild(img);
      return card;
    }

    function openModal(imageSrc) {
      const modal = document.getElementById('modal');
      const modalImg = document.getElementById('modal-image');
      modalImg.src = imageSrc;
      modal.style.display = 'block';
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    document.getElementById('modal').addEventListener('click', closeModal);
    document.querySelector('.modal-close').addEventListener('click', closeModal);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    function showError(message) {
      document.getElementById('loading').style.display = 'none';
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    loadFigures();
  </script>
</body>
</html>


